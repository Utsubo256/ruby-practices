#!/usr/bin/env ruby
# frozen_string_literal: true

require 'optparse'
require 'etc'

def main
  params = options
  args = ARGV
  file_details = file_details(args)
  display_files(file_details, params)
  display_total_files(file_details, params) if file_details.size >= 2
end

def options
  opt = OptionParser.new
  params = {}
  opt.on('-l') { |v| params[:l] = v }
  opt.on('-w') { |v| params[:w] = v }
  opt.on('-c') { |v| params[:c] = v }
  opt.parse!(ARGV)
  params
end

def file_details(args)
  args.map do |arg|
    file = File.new(arg)
    content = file.read
    nline = content.count("\n")
    nword = content.gsub(/\t|\n/, ' ').strip.squeeze(" ").count(' ') + 1
    byte_size = file.size
    { nline:, nword:, byte_size:, name: arg }
  end
end

def display_files(file_details, params)
  max_digit = file_details.sum { |file_detail| file_detail[:byte_size] }.to_s.size
  file_details.each do |file_detail|
  target_details = []
    target_details << file_detail[:nline].to_s.rjust(max_digit, ' ') if params[:l] || params.empty?
    target_details << file_detail[:nword].to_s.rjust(max_digit, ' ') if params[:w] || params.empty?
    target_details << file_detail[:byte_size].to_s.rjust(max_digit, ' ') if params[:c] || params.empty?
    target_details << file_detail[:name]
    puts target_details.join(' ')
  end
end

def display_total_files(file_details, params)
  target_details = []
  max_digit = file_details.sum { |file_detail| file_detail[:byte_size] }.to_s.size
  target_details << file_details.sum { |file| file[:nline] }.to_s.rjust(max_digit, ' ') if params[:l] || params.empty?
  target_details << file_details.sum { |file| file[:nword] }.to_s.rjust(max_digit, ' ') if params[:w] || params.empty?
  target_details << file_details.sum { |file| file[:byte_size] }.to_s.rjust(max_digit, ' ') if params[:c] || params.empty?
  target_details << "total"
  puts target_details.join(' ')
end

main
